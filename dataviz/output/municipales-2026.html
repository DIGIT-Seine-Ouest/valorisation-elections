<ods-dataset-context context="resultatsmunicipales2026, bureauxdevoteelectoraux2026, limitedecommune" 
    resultatsmunicipales2026-dataset="resultats-municipales-2026"
    resultatsmunicipales2026-parameters="{'sort':'-num_bureau'}"
    bureauxdevoteelectoraux2026-dataset="bureaux-de-vote-electoraux-2026" 
    bureauxdevoteelectoraux2026-parameters="{'disjunctive.num_bureau':true,'disjunctive.num_bureau':true}" 
    limitedecommune-dataset="limite-de-commune">
    <section class="container-fluid">
        <header class="app-header">
    <h1 class="app-title">Municipales 2026</h1>
</header>
        <div class="result-detailed">
            <div class="sidebar">
    <!-- Afficher les datas -->
    <div class="filter-title">Les quartiers</div>
    <!-- Lister les lieux de votes -->
     <ul class="filter-list"
        ods-adv-analysis="bureaux"
        ods-adv-analysis-context="resultatsmunicipales2026"
        ods-adv-analysis-select="num_bureau, nom_bureau"
        ods-adv-analysis-group-by="num_bureau, nom_bureau">
        <li class="filter-item" ng-if="resultatsmunicipales2026.parameters['refine.num_bureau']" ng-click="resultatsmunicipales2026.parameters = {'sort':'-num_bureau'}">
            <span class="station-num" style="background:var(--text-dark); color:white;"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path><circle cx="12" cy="12" r="3"></circle></svg></span>
            Clear filter 
        </li>
        <li class="filter-item" ng-repeat="bureau in bureaux">
            <span ng-click="resultatsmunicipales2026.parameters['refine.num_bureau'] = bureau.num_bureau">
                <span class="station-num">{{ bureau.num_bureau }}</span> 
                &nbsp; <span class="station-num-texte">{{ bureau.nom_bureau | uppercase }}</span>
            </span>
        </li>
    </ul>
</div>
            <!-- color-categories="{'BVOT048_1':'#FF6B6B','BVOT048_2':'#4ECDC4','BVOT048_3':'#45B7D1','BVOT048_4':'#FFA07A','BVOT048_5':'#98D8C8','BVOT048_6':'#F7DC6F','BVOT048_7':'#BB8FCE','BVOT048_8':'#85C1E2','BVOT048_9':'#F8B739','BVOT048_10':'#52B788','BVOT048_11':'#E63946','BVOT048_12':'#A8DADC','BVOT048_13':'#F77F00','BVOT048_14':'#06FFA5','BVOT048_15':'#D62828','BVOT048_16':'#023E8A','BVOT048_17':'#00B4D8','BVOT048_18':'#90E0EF','BVOT048_19':'#CAF0F8','BVOT048_20':'#8338EC','BVOT048_21':'#FF1493','BVOT048_22':'#32CD32','BVOT048_23':'#FFD700','BVOT048_24':'#FF4500','BVOT048_25':'#1E90FF','BVOT048_26':'#FF69B4','BVOT048_27':'#00CED1','BVOT048_28':'#9370DB','BVOT048_29':'#FF8C00','BVOT048_30':'#20B2AA','BVOT048_31':'#DC143C','BVOT048_32':'#7FFF00'}"  -->
 <!-- color-by-field="id_bur_vote"  -->
                <!-- color-categories-other="#C32D1C"  -->
<div class="content-maps">
    <ods-map 
        no-refit="false" 
        scroll-wheel-zoom="false" 
        basemap="jawg.light" 
        style="height: 100%;">
            <ods-map-layer 
                context="bureauxdevoteelectoraux2026" 
                color="rgb(101, 167, 11)"
                picto="dot" 
                show-marker="false" 
                display="categories" 
                shape-opacity="0.5" 
                point-opacity="1" 
                border-color="#19630A" 
                border-opacity="1" 
                border-size="1" 
                border-pattern="solid" 
                size="7"></ods-map-layer>

            <ods-map-layer 
                context="limitedecommune" 
                color="#AAAAAA" 
                picto="ods-circle" 
                show-marker="true" 
                display="auto" 
                shape-opacity="0.3" 
                point-opacity="1" 
                border-color="#19630A"
                border-opacity="1" 
                border-size="3" 
                border-pattern="solid" 
                caption-picto-color="#E5E5E5" 
                size="4" size-min="3" size-max="5" size-function="linear"></ods-map-layer>
    </ods-map>
</div>
            <div class="detail-panel">
    <div class="panel-header animate-fade" ng-if="!resultatsmunicipales2026.parameters['refine.num_bureau']">
        <div class="panel-context">Résultats de la ville entière</div>
        <h2 class="panel-title">Meudon (Total)</h2>
    </div>
    <div class="panel-header animate-fade" ng-if="resultatsmunicipales2026.parameters['refine.num_bureau']">
        <div class="panel-context">BUREAU N°</div>
        <h2 class="panel-title">num_bureau</h2>
    </div>
    <div class="panel-body">
        <!-- Partie résulats d'aggregations -->
        <div class="stats-grid-main">
            <!-- Afficher le nombre d'inscrits -->
            <div class="stat-card-main">
                <span class="val-main"
                    ods-analysis="Inscrits"
                    ods-analysis-context="resultatsmunicipales2026"
                    ods-analysis-x="liste"
                    ods-analysis-serie-inscrits="SUM(nb_inscrits)">
                    {{Inscrits["results"][0].inscrits | number}}
                </span>
                <span class="lbl-main">Inscrits</span>
            </div>

            <!-- Afficher le nombre de votants  -->
            <div class="stat-card-main">
                <span class="val-main"
                    ods-analysis="Votants"
                    ods-analysis-context="resultatsmunicipales2026"
                    ods-analysis-x="liste"
                    ods-analysis-serie-votants="SUM(nb_votants)">
                    {{Votants["results"][0].votants | number}}
                </span>
                <span class="lbl-main">Votants</span>
            </div>

            <!-- Calculer le taux de participation -->
            <div class="stat-card-main" style="border-color:var(--green-primary);">
                 <span class="val-main" style="color:var(--green-primary);" 
                    ods-adv-analysis="voteParticipation"
                    ods-adv-analysis-context="resultatsmunicipales2026"
                    ods-adv-analysis-select="(sum(nb_votants) / sum(nb_inscrits)) * 100 as participation"
                    ods-adv-analysis-group-by="liste">
                    {{ voteParticipation[0].participation | number:2 }} %
                </span>
                </span>
                <span class="lbl-main">Participation</span>
            </div>

        </div>
    
        <div class="stats-grid-sub">
            <!-- Calculer nombre de voix exprimé -->
            <div class="stat-card-sub highlight-stat">
                <div class="val-sub"
                    ods-adv-analysis="votesExprimes"
                    ods-adv-analysis-context="resultatsmunicipales2026"
                    ods-adv-analysis-select="sum(nb_votants) - ( sum(nb_nuls) + sum(nb_blanc) ) as total_votes_exprimes"
                    ods-adv-analysis-group-by="liste">
                    {{ votesExprimes[0].total_votes_exprimes | number }}
                </div>
                <span class="lbl-sub">Exprimés</span>
            </div>

            <!-- Afficher le nb d'abstention -->
            <div class="stat-card-sub">
                <span 
                    class="val-sub"
                    ods-analysis="Abstentions"
                    ods-analysis-context="resultatsmunicipales2026"
                    ods-analysis-x="liste"
                    ods-analysis-serie-abstentions="SUM(nb_abstentions)">
                    {{Abstentions["results"][0].abstentions | number}}
                </span>
                <span class="lbl-sub">Abstentions</span>
            </div>

            <!-- Afficher le nb de null -->
            <div class="stat-card-sub">
                <span 
                    class="val-sub"
                    ods-analysis="Blancs"
                    ods-analysis-context="resultatsmunicipales2026"
                    ods-analysis-x="liste"
                    ods-analysis-serie-blanc="SUM(nb_blanc)">
                    {{Blancs["results"][0].blanc | number}}
                </span>
                <span class="lbl-sub">Blancs</span>
            </div>

            <!-- Afficher les nuls -->
            <div class="stat-card-sub">
                <span 
                    class="val-sub"
                    ods-analysis="Nuls"
                    ods-analysis-context="resultatsmunicipales2026"
                    ods-analysis-x="liste"
                    ods-analysis-serie-nuls="SUM(nb_nuls)">
                    {{Nuls["results"][0].nuls | number}}
                </span>
                <span class="lbl-sub">Nuls</span>
            </div>
        </div>

        <!-- Partie résultats filtrée ou pas. -->
        <h4 style="margin-bottom:15px; color:var(--text-dark); font-size:14px; font-weight:700; text-transform:uppercase;">Résultats détaillé</h4>
        <!-- Faire une boucle ICI  -->
        <div ods-analysis="candidats"
            ods-analysis-context="resultatsmunicipales2026"
            ods-analysis-x="liste"
            ods-analysis-serie-nombre="SUM(nombre_de_voies)"
            ods-analysis-sort="nombre">
            <div class="res-item" ng-repeat="candidat in candidats['results']">

                <div class="res-header">
                    <span class="res-name">{{candidat.x}}</span>
                    <span style="font-weight:bold; color:var(--text-dark);">
                        <span 
                            ods-adv-analysis="votesExprimes"
                            ods-adv-analysis-context="resultatsmunicipales2026"
                            ods-adv-analysis-select="sum(nb_votants) - ( sum(nb_nuls) + sum(nb_blanc) ) as total_votes_exprimes"
                            ods-adv-analysis-group-by="liste">
                            {{ (candidat.nombre / votesExprimes[0].total_votes_exprimes) * 100 | number:2 }} %
                        </span>
                    </span>
                </div>

                <div ods-adv-analysis="votesExprimes"
                    ods-adv-analysis-context="resultatsmunicipales2026"
                    ods-adv-analysis-select="sum(nb_votants) - ( sum(nb_nuls) + sum(nb_blanc) ) as total_votes_exprimes"
                    ods-adv-analysis-group-by="liste">
                    <div class="progress-track">
                        <div class="progress-bar c-1" 
                            style="width: {{ (candidat.nombre / votesExprimes[0].total_votes_exprimes) * 100 }}%">
                        </div>
                    </div>
                    
                </div>
                <div style="font-size:11px; color:#888; margin-top:3px; text-align:right;">
                    {{candidat.nombre | number }} voix
                </div>
            </div>
        </div>
    </div>
</div>
        </div>
    </section>
</ods-dataset-context>